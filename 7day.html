<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <title>Zamówienie — Czarni Pruszcz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body{font-family:sans-serif;background:#0b1220;color:#fff;padding:20px}
    .card{max-width:600px;margin:auto;background:#111b2e;border-radius:12px;padding:20px}
    h1{font-size:24px;margin:0 0 10px}
    label{display:block;margin-top:10px}
    input,select{width:100%;padding:10px;margin-top:5px;border-radius:8px;border:1px solid #ccc}
    button{margin-top:20px;padding:12px 20px;border:0;border-radius:8px;background:#2aa7ff;color:#000;font-weight:bold;cursor:pointer}
    pre{margin-top:20px;background:#000;padding:10px;border-radius:8px;color:#9fc9ff;white-space:pre-wrap}
  </style>
</head>
<body>

  <div class="card">
    <h1>Koszulka Akademia Czarni Pruszcz</h1>
    <p>Cena: <strong>89,00 zł</strong></p>

    <label>Rozmiar:
      <select id="size">
        <option value="">-- wybierz --</option>
        <option>122</option><option>134</option><option>146</option>
        <option>158</option><option>S</option><option>M</option>
        <option>L</option><option>XL</option>
      </select>
    </label>

    <label>Ilość:
      <input type="number" id="qty" value="1" min="1">
    </label>

    <label>Imię i nazwisko:
      <input type="text" id="buyer_name">
    </label>

    <label>E-mail:
      <input type="email" id="buyer_email">
    </label>

    <label>Paczkomat InPost:
      <input type="text" id="inpost_point" placeholder="np. GDA01A">
    </label>

    <button id="order">Zamów teraz</button>

    <pre id="out">--</pre>
  </div>

<script>
const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbxf79MRHc6nsBSFIbtLTPt9D7jdV-rZkSzpNft0AH0qJcUHyW2BZr_9HD6BsDY_VzZg/exec';
const TOKEN = 'czarni123';

function buildPayload(){
  return {
    shop: "Czarni Pruszcz",
    product: {
      id: "czarni-koszulka-001",
      name: "Koszulka Akademia Czarni Pruszcz",
      size: document.getElementById('size').value,
      unit_price: 89,
      quantity: parseInt(document.getElementById('qty').value,10)
    },
    buyer: {
      name: document.getElementById('buyer_name').value,
      email: document.getElementById('buyer_email').value
    },
    delivery: {
      method: "InPost Paczkomat",
      point: document.getElementById('inpost_point').value
    },
    payment: {
      provider: "Przelewy24",
      method: "redirect"
    },
    totals: {
      currency: "PLN",
      gross: 89 * Math.max(1, parseInt(document.getElementById('qty').value,10))
    }
  };
}

function show(x){ document.getElementById('out').textContent = typeof x==='string'?x:JSON.stringify(x,null,2); }

document.getElementById('order').addEventListener('click', async ()=>{
  const payload = buildPayload();
  show(payload);

  try{
    const res = await fetch(`${WEBAPP_URL}?token=${encodeURIComponent(TOKEN)}`, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain' },
      body: JSON.stringify(payload)
    });
    const ct = res.headers.get('content-type') || '';
    const data = ct.includes('application/json') ? await res.json() : await res.text();
    show(data);

    if(res.ok && (data.ok || data.saved)){
      alert('Zamówienie zapisane ✅');
    }else{
      alert('Błąd zapisu: ' + (data.error || res.status));
    }
  }catch(e){
    alert('Błąd połączenia: ' + e.message);
  }
});
</script>
</body>
</html>
