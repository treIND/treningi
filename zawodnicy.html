<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zawodnicy — panel</title>
  <style>
    :root{
      --bg:#0b0b0b;        /* tło */
      --text:#eaeaea;      /* tekst */
      --card:#111111;      /* karty */
      --border:#2a2a2a;    /* obramowania */
      --muted:#aaaaaa;     /* opisowy */
      --primary:#2563eb;   /* niebieski */
      --primary-600:#1d4ed8;
      --danger:#b91c1c;
      --danger-600:#991b1b;
      --input:#0b0b0b;
    }
    *{box-sizing:border-box}
    body{background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:20px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px}
    .muted{color:var(--muted);font-size:12px}

    /* przyciski */
    .btn{padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:#1f2937;color:#fff;cursor:pointer;transition:filter .15s ease,transform .05s ease}
    .btn:hover{filter:brightness(1.1)}
    .btn:active{transform:translateY(1px)}
    .btn-primary{background:var(--primary);border-color:var(--primary-600)}
    .btn-primary:hover{background:var(--primary-600)}
    .btn-danger{background:var(--danger);border-color:var(--danger-600)}
    .btn-danger:hover{background:var(--danger-600)}
    .btn-ghost{background:transparent;border-color:var(--border)}

    /* ładniejszy przycisk powrotu */
    .btn-back{display:inline-flex;align-items:center;gap:10px;padding:10px 16px;border:none;border-radius:999px;text-decoration:none;color:#fff;font-weight:600;background:linear-gradient(135deg,var(--primary),var(--primary-600));box-shadow:0 6px 20px rgba(37,99,235,.28);transition:transform .08s ease,box-shadow .2s ease}
    .btn-back:hover{transform:translateY(-1px);box-shadow:0 10px 26px rgba(37,99,235,.35)}

    /* formularze */
    input{background:var(--input);border:1px solid var(--border);color:#eee;border-radius:10px;padding:10px 12px;width:100%;outline:none}
    input::placeholder{color:#8b8b8b}

    /* tabela */
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{border-bottom:1px solid #1e1e1e;padding:10px 12px;text-align:left;vertical-align:middle}
    thead th{background:#151515;position:sticky;top:0;z-index:1}
    .row-actions{display:flex;gap:8px}

    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:12px}
    .grid-add{display:grid;grid-template-columns:1.2fr 1fr .6fr auto;gap:10px;align-items:center}
    @media (max-width:720px){
      .grid-add{grid-template-columns:1fr}
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <a class="btn-back" href="./index.html" aria-label="Powrót do strony głównej">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    Powrót do strony głównej
  </a>

  <div class="card" style="margin-bottom:14px">
    <div class="toolbar" style="margin-bottom:10px"><strong>Dodaj zawodnika</strong></div>
    <div class="grid-add">
      <input id="add_name" placeholder="Imię i nazwisko" />
      <input id="add_phone" placeholder="Telefon" />
      <input id="add_rocznik" placeholder="Rocznik (np. 2016)" />
      <button class="btn btn-primary" onclick="addPlayer()">Dodaj</button>
    </div>
    <p class="muted" style="margin-top:8px">ID tworzy się samo w bazie — nie pokazujemy go w widoku.</p>
  </div>

  <div class="card">
    <div class="toolbar">
      <strong>Lista zawodników</strong>
      <button class="btn btn-ghost" onclick="loadPlayers()">Odśwież</button>
    </div>
    <div id="playersTableWrap"><div class="muted">Ładowanie…</div></div>
  </div>

  <script>
    // Supabase
    const SUPABASE_URL = "https://vwthvwqcqlsnikvqdeia.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ3dGh2d3FjcWxzbmlrdnFkZWlhIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MzczMDI2NCwiZXhwIjoyMDY5MzA2MjY0fQ.IRZwe-xSdLbOGPLTupsGubivGV6_-jRgw3C-9zPfpKA";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    function rowInputs(p){
      return (
        '<tr data-id="'+p.id+'">'+
          '<td><input value="'+(p.name||'')+'" data-field="name" placeholder="Imię i nazwisko" /></td>'+
          '<td><input value="'+(p.phone||'')+'" data-field="phone" placeholder="Telefon" /></td>'+
          '<td style="width:140px"><input value="'+(p.rocznik??'')+'" data-field="rocznik" placeholder="np. 2016" /></td>'+
          '<td class="row-actions">'+
            '<button class="btn btn-primary" onclick="saveRow(this)">Zapisz</button>'+
            '<button class="btn btn-danger" onclick="deleteRow(this)">Usuń</button>'+
          '</td>'+
        '</tr>'
      );
    }

    async function loadPlayers(){
      const { data, error } = await supabase
        .from("players")
        .select("*")
        .order("name", { ascending: true });
      if (error){
        document.getElementById('playersTableWrap').innerHTML = '<p>Błąd: '+error.message+'</p>';
        return;
      }
      const rows = (data||[]).map(rowInputs).join("");
      document.getElementById('playersTableWrap').innerHTML = `
        <table>
          <thead>
            <tr>
              <th>Imię i nazwisko</th>
              <th>Telefon</th>
              <th>Rocznik</th>
              <th>Akcje</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>`;
    }

    function collectRowPayload(tr){
      const inputs = tr.querySelectorAll('[data-field]');
      const payload = {};
      inputs.forEach(el=>{
        const f = el.getAttribute('data-field');
        if (f === 'rocznik'){
          payload[f] = el.value.trim()==='' ? null : Number(el.value.trim());
        } else {
          payload[f] = el.value.trim()==='' ? null : el.value.trim();
        }
      });
      return payload;
    }

    async function addPlayer(){
      const name = document.getElementById('add_name').value.trim();
      const phone = document.getElementById('add_phone').value.trim();
      const rocznikRaw = document.getElementById('add_rocznik').value.trim();
      const rocznik = rocznikRaw==='' ? null : Number(rocznikRaw);
      if(!name){ alert('Podaj imię i nazwisko'); return; }
      const { error } = await supabase.from('players').insert([{ name, phone, rocznik }]);
      if(error){ alert('Błąd dodawania: '+error.message); return; }
      document.getElementById('add_name').value='';
      document.getElementById('add_phone').value='';
      document.getElementById('add_rocznik').value='';
      await loadPlayers();
    }

    async function saveRow(btn){
      const tr = btn.closest('tr');
      const id = Number(tr.getAttribute('data-id'));
      const payload = collectRowPayload(tr);
      const { error } = await supabase.from('players').update(payload).eq('id', id);
      if(error){ alert('Błąd zapisu: '+error.message); return; }
      await loadPlayers();
    }

    async function deleteRow(btn){
      const tr = btn.closest('tr');
      const id = Number(tr.getAttribute('data-id'));
      if(!confirm('Usunąć tego zawodnika?')) return;
      if(!confirm('Na pewno? Tej operacji nie da się cofnąć.')) return;
      const { error } = await supabase.from('players').delete().eq('id', id);
      if(error){ alert('Błąd usuwania: '+error.message); return; }
      await loadPlayers();
    }

    loadPlayers();
  </script>
</body>
</html>
